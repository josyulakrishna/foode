function foodlistgo(){$.ajax({url:"/editmenulistview/"+rest_id+"/",success:function(a){var b;if(a.menulists.length!=0){$("#resultcitems").hide();$(".prelists").show();$(".preitems").show();$(".edit-mini-template").show();$("#saveitems").show();$(".additem").show();$("#foodlist-content").show();$(".remlists").show();$(".oldfoodlists").show();var c={"div.preaddeditems":{"tmp<-menulists":{".@id":"listheading#{tmp.id}",h4:"tmp.listname","div.addfooditems-template@id":"itemsadd#{tmp.id}","a.additem@id":"add#{tmp.id}","div.edit-mini-template":{"itm<-tmp.menuitems":{"input@value":"itm.itemname","input@name":"itm.id","input@id":"citemremi#{itm.id}","a.delitems":'<i class="icon-remove icon-white"></i>',"a.delitems@id":"delremi#{itm.id}"}}}}};$(".currentmenuitems").render(a,c);var c={".foodlist-template":{"tmp<-menulists":{".@id":"foodlist#{tmp.id}",".@cp":"listheading#{tmp.id}",a:'#{tmp.listname}<i class="icon-chevron-right"></i>',"a@href":"#listheading#{tmp.id}"}}};$("#foodlist-content").render(a,c);$(".foodlist-template:first").addClass("active");$("div.preaddeditems").hide();$("div.preaddeditems:first").show();$("#resultclists").hide();$(".prelists").show();var c={"div.preaddedlists":{"tmp<-menulists":{"input@value":"tmp.listname","input@name":"tmp.id","input@id":"clistreml#{tmp.id}","a.remlists":'&nbsp<i class="icon-remove icon-black"></i>',"a.remlists@id":"reml#{tmp.id}"}}};$(".currentlists").render(a,c)}else{$(".prelists").hide();$(".preitems").hide();$("#resultcitems").show();$(".edit-mini-template").hide();$("#saveitems").hide();$(".additem").hide();$("#foodlist-content").hide()}}})}function go(){$("#menuitemsresultcontent").show();$.ajax({url:"/editmenulistview/"+rest_id+"/",success:function(a){if(a.menulists.length!=0){$("#menutable").show();var b={"div#menutable":{"tmp<-menulists":{h4:"tmp.listname","tr.micon":{"itm<-tmp.menuitems":{"a.itname":"itm.itemname"}}}}};var c=$("#menuitemsresultcontent").compile(b);$("#menuitemsresultcontent").render(a,c)}else{$("#menuresult").show();$("#menutable").hide()}}})}function newfooditemshandler(){if($("input.addedmenuitems").length>0){for(var a=0;a<tmpfooditems.length;a++){var b=$("#"+tmpfooditems[a]).attr("value");$("#"+tmpfooditems[a]).attr("value",b)}for(var c=0;c<$(".addfooditems-template").length;c++){$("#newmenuitemsform").append($(".addfooditems-template").eq(c).html())}$(".addfooditems-template:not(:first)").remove();$(".addfooditems-template").empty();$.ajax({data:$("#newfooditems-tempform").serialize(),type:$("#newfooditems-tempform").attr("method"),url:$("#newfooditems-tempform").attr("action"),success:function(a){}});return true}else return false}function cleaner(){$(".foodlist-template:not(:first)").remove();$(".foodlist-template:first").removeClass("active");$(".preaddedlists:not(:first)").remove();$("#newfoodlists-form").empty();$(".preaddeditems:not(:first)").remove();$(".addfooditems-template:not(:first)").remove();$(".addfooditems-template").empty();if($(".edit-mini-template").length==0||$(".edit-mini-template").length==1){$(".edit-mini-template:first").remove();$(".backup-edit-mini-template:first").insertBefore($(".addfooditems-template:first"));$(".backup-edit-mini-template:first").addClass("edit-mini-template");$(".edit-mini-template:first").removeClass("backup-edit-mini-template");$(".edit-mini-template:first").clone().appendTo($("#menuitemsresultcontent"));$(".edit-mini-template:last").addClass("backup-edit-mini-template");$(".backup-edit-mini-template:last").removeClass("edit-mini-template")}else{$(".edit-mini-template:not(:first)").remove()}$("#newmenuitemsform").empty();if($("input.menuitems").length==1){$(input_backup).appendTo($(".edit-mini-template:first"))}if($("input.oldfoodlists").length==0){$(prelists_backup).appendTo($(".preaddedlists:first"))}$(".currentmenuitems").show();$("#menuitemsresultcontent").hide();cleanmenupreview()}function cleanmenupreview(){$("div.menutable-template:not(:first)").remove();if($(".micon").length==0){$(table_backup).appendTo($("table"))}else{$(".micon:not(:first)").remove()}}var tmpfooditems=[];var tmpfoodlists=[];var mcount=0;var table_backup='<tr class="micon"><td class="itname"><a style="color:green;text-decoration:none;" class="itname"></a></td></tr>';var input_backup='<input type="text" class="field input-xlarge menuitems" value=""/><a class="delitems" href="#"></a>';var prelists_backup='<input type="text" class="oldfoodlists field input-xllarge" value="" flag="yes"/><a class="remlists" style="text-decoration:none;" href="#deleteModal"></a>';$(function(){foodlistgo();mcount++;$("#basic_info").click(function(){$(this).addClass("active");$("div#editbasic").show();$("div#menubook").hide();$("#menu_book").removeClass("active")});$("#menu_book").click(function(){$(this).addClass("active");$("#menubook").show();$("div#editbasic").hide();$("#basic_info").removeClass("active");if(mcount>0){cleaner()}foodlistgo();mcount++});$("#editlist").click(function(){$(".foodlisttabs").hide();$(".currentlists").show();$("#savelists").show();$("#menuitemsbook").hide();$("#editingfoodlists").show()});$("#editagain").live("click",function(){$("#foodlistspreview").hide();$("#foodlists").show();$(".foodlisttabs").show();$("#savelists").show();$("#menuitemsbook").show();$("#menuitemsresultcontent").hide();$(".currentmenuitems").show();$("#saveitems").show();$("#preitems").show();cleaner();foodlistgo()});$(".foodlist-template").live("click",function(){$(".foodlist-template").removeClass("active");$("div.preaddeditems").hide();var a=$(this).attr("id");var b=$(this).attr("cp");$("div#"+b).show();$("#"+a).addClass("active")})});$(".delitems").live("click",function(){var a=$(this).attr("id");$(this).remove();$("#"+a).remove();sid=a.slice(3);$("#citem"+sid).remove();tid=a.slice(7);$.ajax({url:"/"+tid+"/removemenuitem/",success:function(a){$("#p"+sid).html(a)}})});$("#saveitems").live("click",function(){$("#saveitems").hide();$("#preitems").hide();newfooditemshandler();$.ajax({data:$(".preitems").serialize(),type:$(".preitems").attr("method"),url:$(".preitems").attr("action"),success:function(a){$(".currentmenuitems").hide();cleanmenupreview();go();$("#foodlistspreview").show();$("#foodlists").hide();$(".foodlisttabs").show();$(".currentlists").hide()}});return false});var j=1;$(".additem").live("click",function(){var a=$(this).attr("id");var b='<input type="text" class="addedmenuitems input-xlarge " name="listitem'+a+"z"+j+'" id="menuitemrem'+j+'" value="Item" "/"><a href="#'+a+'" style="text-decoration:none;" class="remove removeitems" id="rem'+j+'">&nbsp<i class="icon-remove icon-white"></i></a><br>';$(b).fadeIn("slow").appendTo("#items"+a);tmp="menuitemrem"+j;tmpfooditems.push(tmp);j++});$(".remove").live("click",function(){var a=$(this).attr("id");$("#menuitem"+a).remove();$("#"+a).remove();j--});$(".modal-del").live("click",function(){var a=$(this).attr("id");sid=a.slice(3);if($(".remlists").length==1){$("#"+sid).hide();$("#clist"+sid).hide();$("#clist"+sid).attr("flag","no")}else{$("#"+sid).remove();$("#clist"+sid).remove()}tid=a.slice(7);$("#deleteModal").modal("toggle");$.ajax({url:"/"+tid+"/removemenulist/",success:function(a){}});j--});$(".remlists").live("click",function(){var a=$(this).attr("id");$(".modal-del").attr("id","del"+a);$("#deleteModal").modal("toggle")});var i=1;$("#add").live("click",function(){var a=$(this).attr("id");var b='<input type="text" class="field newfoodlistinputs" name="dynamiclist'+i+' " id="newfoodlist'+i+'" value="Category"  "/"><a style="text-decoration:none;" href="#'+a+'" class="remove-templists" id ="foodlist'+i+'" >&nbsp&nbsp<i class="icon-remove icon-black"></i></a>';$(b).fadeIn("slow").appendTo("#newfoodlists-form");var c="newfoodlist"+i;tmpfoodlists.push(c);i++});$(".remove-templists").live("click",function(){var a=$(this).attr("id");$("#new"+a).remove();$(this).remove();i--});$("#savelists").live("click",function(){$("#savelists").hide();$("#prelists").hide();$("#menuitemsbook").show();$("#editingfoodlists").hide();if($("input.oldfoodlists").length==1&&$("input.oldfoodlists:first").attr("flag")=="no"){}else{$.ajax({data:$(".prelists").serialize(),type:$(".prelists").attr("method"),url:$(".prelists").attr("action"),success:function(a){}})}if($(".newfoodlistinputs").length>0){for(var a=0;a<tmpfoodlists.length;a++){var b=$("#"+tmpfoodlists[a]).attr("value");$("#"+tmpfoodlists[a]).attr("value",b)}$.ajax({data:$("#newfoodlists-form").serialize(),type:$("#newfoodlists-form").attr("method"),url:$("#newfoodlists-form").attr("action"),success:function(a){}})}cleaner();foodlistgo();$(".foodlisttabs").show();$(".currentlists").hide();return false})
